---
title: "Religion-in-America"
author: "Mark Hand"
date: "1/23/2019"
output: html_document
---

```{r setup, include=FALSE}
#setup
knitr::opts_chunk$set(echo = TRUE)

#For data wrangling
library(tidyverse)
```

There are [?] churches in the United States, from some [?] denominations [Source]. What do they think? How are they similar, and how do they differ? The fault lines that divide Christians today--gay marriage, women in leadership positions--aren't the same that caused denominations to split in the past. 

Perhaps, then, there are some denominations that have more similar beliefs than their current positions on the Christian family tree might suggest. What if we could unearth denominations that are similar enough that they might want to work together--or perhaps even merge? 

# Machine Learning, Human Beliefs 

In 2014, the Pew Research Center's [Forum on Religion & Public Life](http://www.pewforum.org/) conducted a country-wide survey of religious belief in the United States. Pew researchers asked people all kinds of questions. They about their beliefs on everything from heaven and hell to abortion, and they asked about their religious practices, from attendace at religious services to how often they read religious texts. 

Thankfully for nerds, Pew does a wonderful job of making their data available to the public, meaning that in addition to reading [the content](http://www.pewforum.org/religious-landscape-study/) they wrote using the data, we can play with the data ourselves. I downloaded their religious surveys data from 

[http://www.pewforum.org/datasets/](http://www.pewforum.org/datasets/)

Then I started playing around with the data in RStudio. What you're looking at now is called an RMarkdown document; it's stored in a sort of Dropbox-for-programmers called GitHub. Here is the homepage for this project: 

[https://github.com/markchand/Religion-in-America](https://github.com/markchand/Religion-in-America)

If you'd like to look at what I did, you'll find data sets and code there. 

```{r data}
### First step: Importing data 

# This package helps us import data 
library(haven) 

# This command imports the data 
pew <- read_sav("Pew-Research-Center-2014-U.S.-Religious-Landscape-Study/Dataset - Pew Research Center 2014 Religious Landscape Study National Telephone Survey - Version 1.1 - December 1 2016.sav")
```

Pew interviewed over 35,000 people in 2015, and asked them dozens of questions. With a dataset that large, it makes sense to use a set of techniques called [machine learning](https://markclaytonhand.com/2018/12/11/python-for-beginners-part-ii-a-little-bit-about-machine-learning-but-dont-panic/). 

Machine learning techniques, and especially one kind of learning called unsupervised learning, lets us look for patterns in the data. 

```{r Belief and Practice}
# Choose subsets of questions with which to cluster respondents 
# names(pew)
# Looking at codebook and dataset together suggests: 
# - qa1:qb31 (then omit affiliation questions)
# - born (then omit)
# - attend:q14d
# - qk10:qm5g (then omit demographic and non-religious belief questions) 

# This cuts the data; I think instead we want "data" and "labels" per the ISL textbook.
# pew.small <- pew %>% select(resp,DENOM,qa1:qb31,born,attend:qi4d,qk10a:qm5g)

# dput() is a useful function for extracting variable names 
dput(names(pew))

# Attempting to create a list of variables with which to do stuff later, copypasted from the list generated by the previous command 
pew.data <- c("resp", "qa1", "qa2a", "qa2b", "qb1a", "qb1b", "qb1c", "qb2a", "qb2b", "qb2c", "qb2d", "qb20", "qb21", "qb22", "qb30", "qb30b", "qb31", "born", "attend", "qf2", "qf5", "qg1", "qg1b", "qg1c", "qg3", "qg5", "qg6", "qg7", "qg7b", "qh1", "qh2", "qh4", "qi1", "qi2a", "qi2b", "qi2c", "qi2d", "qi2g", "qi2h", "qi2m", "qi2t", "qi2u", "qi3", "qi3b", "qi4a", "qi4b", "qi4c", "qi4d","qk10a", "qk10b", "qk10c", "qk10d", "qm5a", "qm5b", "qm5d", "qm5e", "qm5f", "qm5g")
pew.labels <- pew$DENOM
pew.small <- pew[pew.data]
pew.small$DENOM <- pew.labels
#Messy, but I think that will work. 
``` 

First step: K-means. This (I think) lets the computer decide which groups to form based on the variables you give it. 

```{r kmeans}
km.out=kmeans(pew.small,3,nstart=100)
# Immediate issue: kmeans doesn't work on observations with NAs, and every observation in this dataset has NAs in it. 
```

```{r hierarchical}
hc.complete=hclust(dist(pew.small[pew.data]), method="complete")

# What does this do? Cut the tree? 
# hc.clusters <- cutree(hc.complete,4)

# Next two: 
# hc.average=hclust(dist(pew.small), method="average") 
# hc.single=hclust(dist(pew.small), method="single")

# This would organize the three plots 
# par(mfrow=c(1,3))

# Plot(s?) from above 
# plot(hc.complete, main="Complete Linkage", xlab="", sub="", cex =.9)
plot(hc.complete, labels=pew.labels, main="Complete Linkage", xlab="", sub="", ylab="")
# Moving in the right direction, but...

# Hold off on these
# plot(hc.average, main="Average Linkage", xlab="", sub="", cex =.9)
# plot(hc.single, main="Single Linkage", xlab="", sub="", cex =.9)

# https://stackoverflow.com/questions/33067547/how-to-substitute-na-by-0-in-20-columns 
# ? 
```

# Coming up 

- Patterns in religious belief
 - K-means (how to label?) 
 - Hierarchical (Does this create a treee? Compare to historical tree?)
  - Then layering back in denominations 
- Which groups should merge
- Other interesting threads 
  - Race
  - Catholicism
  - Region 
  - Politics
  - Whether someone knows someone who is gay 
  - Economics 